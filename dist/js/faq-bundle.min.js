function e(){const e=document.documentElement,t=localStorage.getItem('theme');if(t)e.setAttribute('data-theme',t);else{const t=window.matchMedia('(prefers-color-scheme: dark)').matches;e.setAttribute('data-theme',t?'dark':'light')}window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change',t=>{localStorage.getItem('theme')||e.setAttribute('data-theme',t.matches?'dark':'light')})}function t(){const e=document.documentElement,t='dark'===e.getAttribute('data-theme')?'light':'dark';e.setAttribute('data-theme',t),localStorage.setItem('theme',t),a()}function a(){const e=document.getElementById('themeToggle');if(!e)return;const t='dark'===document.documentElement.getAttribute('data-theme');e.innerHTML=t?'<i class="fas fa-sun"></i>':'<i class="fas fa-moon"></i>'}function s(){const e=document.createElement('button');e.innerHTML='<i class="fas fa-arrow-up"></i>',e.className='scroll-to-top',e.style.cssText='\n        position: fixed;\n        bottom: 30px;\n        right: 30px;\n        width: 50px;\n        height: 50px;\n        background: linear-gradient(135deg, var(--current-primary), var(--accent));\n        color: white;\n        border: none;\n        border-radius: 50%;\n        cursor: pointer;\n        opacity: 0;\n        visibility: hidden;\n        transition: all 0.3s ease;\n        z-index: 1000;\n        box-shadow: 0 4px 15px rgba(134, 93, 187, 0.3);\n    ',document.body.appendChild(e),window.addEventListener('scroll',()=>{window.pageYOffset>300?(e.style.opacity='1',e.style.visibility='visible'):(e.style.opacity='0',e.style.visibility='hidden')}),e.addEventListener('click',()=>{window.scrollTo({top:0,behavior:'smooth'})}),e.addEventListener('mouseenter',()=>{e.style.transform='translateY(-3px) scale(1.1)'}),e.addEventListener('mouseleave',()=>{e.style.transform='translateY(0) scale(1)'})}function n(){document.addEventListener('keydown',e=>{'Escape'===e.key&&window.scrollTo({top:0,behavior:'smooth'}),' '===e.key&&e.target===document.body&&e.preventDefault()})}function i(){const e=document.createElement('button');function t(){const t=document.querySelector('.nav-links'),a=document.querySelectorAll('.nav-links li:not(:last-child)'),s=document.getElementById('themeToggle');if(window.innerWidth<=768){if(e.style.display='flex',t&&s){let e=document.getElementById('mobile-nav');if(!e){e=document.createElement('div'),e.id='mobile-nav',e.className='mobile-nav',e.style.cssText='\n                        position: fixed;\n                        top: 0;\n                        right: -100%;\n                        width: 280px;\n                        height: 100vh;\n                        background: var(--current-card-bg);\n                        box-shadow: -5px 0 20px rgba(0, 0, 0, 0.15);\n                        z-index: 1000;\n                        transition: right 0.3s ease;\n                        padding: 80px 20px 20px;\n                        overflow-y: auto;\n                    ';const t=document.createElement('ul');t.className='mobile-nav-list',t.style.cssText='\n                        list-style: none;\n                        padding: 0;\n                        margin: 0;\n                    ',a.forEach(e=>{const a=document.createElement('li');a.style.cssText='\n                            margin-bottom: 15px;\n                        ',a.innerHTML=e.innerHTML,t.appendChild(a)}),e.appendChild(t),document.body.appendChild(e)}}}else{e.style.display='none';const t=document.getElementById('mobile-nav');t&&(t.style.right='-100%')}}e.className='mobile-menu-btn',e.innerHTML='<i class="fas fa-bars"></i>',e.style.cssText='\n        display: none;\n        position: fixed;\n        top: 15px;\n        right: 20px;\n        width: 50px;\n        height: 50px;\n        background: var(--current-primary);\n        color: white;\n        border: none;\n        border-radius: 50%;\n        cursor: pointer;\n        z-index: 1001;\n        box-shadow: 0 4px 15px rgba(134, 93, 187, 0.3);\n        align-items: center;\n        justify-content: center;\n        font-size: 1.2rem;\n    ',document.body.appendChild(e),t(),window.addEventListener('resize',t),e.addEventListener('click',()=>{const t=document.getElementById('mobile-nav');t&&('0px'===t.style.right?(t.style.right='-100%',e.innerHTML='<i class="fas fa-bars"></i>'):(t.style.right='0',e.innerHTML='<i class="fas fa-times"></i>'))}),document.addEventListener('click',t=>{const a=document.getElementById('mobile-nav');!a||'0px'!==a.style.right||a.contains(t.target)||t.target===e||e.contains(t.target)||(a.style.right='-100%',e.innerHTML='<i class="fas fa-bars"></i>')})}document.addEventListener('DOMContentLoaded',()=>{e(),a(),n(),i();const s=document.getElementById('themeToggle');s&&s.addEventListener('click',t);const r=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.style.animation='fadeIn 0.6s ease-out forwards')})},{threshold:.1});document.querySelectorAll('.animated').forEach(e=>{r.observe(e)})}),window.addEventListener('load',()=>{s()});class r{constructor(){this.faqData=[],this.filteredData=[],this.searchTerm='',this.activeCategory='all',this.categories={},this.init()}async init(){try{await this.loadFAQData(),this.renderFAQs(),this.bindEvents(),this.hideLoading()}catch(e){this.showError()}}async loadFAQData(){try{const e=await fetch('/assets/FAQs.md');if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.text();this.parseFAQMarkdown(t)}catch(e){throw e}}parseFAQMarkdown(e){const t=e.split('\n');let a=null,s=[],n='',i='',r='';for(let e=0;e<t.length;e++){const o=t[e].trim();o.startsWith('# ')||(o.startsWith('## ')?(a&&this.faqData.push({question:a,answer:s.join('\n').trim(),category:r,mainCategory:n,subCategory:i,id:this.generateId(a)}),n=o.substring(3).trim(),r=n,a=null,s=[]):o.startsWith('### ')?(a&&this.faqData.push({question:a,answer:s.join('\n').trim(),category:r,mainCategory:n,subCategory:i,id:this.generateId(a)}),a=o.substring(4).trim(),i=a,r=`${n}-${i}`,s=[]):a&&o&&s.push(o))}a&&this.faqData.push({question:a,answer:s.join('\n').trim(),category:r,mainCategory:n,subCategory:i,id:this.generateId(a)}),this.organizeCategories(),this.filteredData=[...this.faqData]}organizeCategories(){this.categories={},this.faqData.forEach(e=>{this.categories[e.mainCategory]||(this.categories[e.mainCategory]={name:e.mainCategory,count:0,subCategories:{}}),this.categories[e.mainCategory].count++,this.categories[e.mainCategory].subCategories[e.subCategory]||(this.categories[e.mainCategory].subCategories[e.subCategory]={name:e.subCategory,count:0,fullCategory:e.category}),this.categories[e.mainCategory].subCategories[e.subCategory].count++})}renderCategories(){const e=document.querySelector('.faq-sidebar');if(!e)return;let t=e.querySelector('.faq-categories');t||(t=document.createElement('div'),t.className='faq-categories',e.appendChild(t)),t.innerHTML=`\n            <h3><i class="fas fa-tags"></i> 问题分类</h3>\n            <ul class="main-categories">\n                <li>\n                    <a href="#" data-category="all" class="category-link ${'all'===this.activeCategory?'active':''}">\n                        <i class="fas fa-layer-group"></i> 全部问题\n                    </a>\n                </li>\n            </ul>\n        `;const a=t.querySelector('.main-categories');Object.keys(this.categories).forEach(e=>{this.categories[e];const t=document.createElement('li');t.className='main-category-item',t.innerHTML=`\n                <a href="#" data-category="${e}" class="category-link main-category-link ${this.activeCategory===e?'active':''}">\n                    ${e}\n                </a>\n            `,a.appendChild(t)})}generateId(e){const t=Date.now(),a=Math.floor(1e3*Math.random());return`${e.toLowerCase().replace(/[^\w\s-]/g,'').replace(/\s+/g,'-').substring(0,30)}-${t}-${a}`}handleLazyImages(){const e=document.querySelectorAll('.lazy-image');if('IntersectionObserver'in window){const t=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const a=e.target;a.onload=()=>{a.classList.add('loaded')},a.complete&&a.classList.add('loaded'),t.unobserve(a)}})},{rootMargin:'0px 0px 200px 0px'});e.forEach(e=>{t.observe(e)})}else e.forEach(e=>{e.classList.add('loaded')})}renderFAQs(){const e=document.getElementById('faqList');0!==this.filteredData.length?(e.innerHTML=this.filteredData.map(e=>`\n            <div class="faq-item" data-category="${e.category}" data-main-category="${e.mainCategory}">\n                <button class="faq-question" data-id="${e.id}">\n                    <span class="tag">${e.mainCategory}</span>\n                    <span class="faq-question-text">${this.highlightSearchTerm(e.question)}</span>\n                    <i class="fas fa-chevron-down faq-toggle"></i>\n                </button>\n                <div class="faq-answer" id="answer-${e.id}">\n                    <div class="faq-answer-content">\n                        ${this.formatAnswer(e.answer)}\n                    </div>\n                </div>\n            </div>\n        `).join(''),this.handleLazyImages()):e.innerHTML='\n                <div class="no-results">\n                    <i class="fas fa-search"></i>\n                    <p>没有找到匹配的问题,请尝试其他关键词.</p>\n                </div>\n            '}formatAnswer(e){let t=e;t=t.replace(/\*\*([^\*]+)\*\*/g,'<strong>$1</strong>'),t=t.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank">$1</a>'),t=t.replace(/!\[([^\]]+)\]\(([^)]+)\)/g,'<img src="$2" alt="$1" loading="lazy" class="lazy-image" />'),t=t.replace(/`([^`]+)`/g,'<code>$1</code>');const a=t.split('\n');let s=!1,n=!1,i=[];for(let e=0;e<a.length;e++){let t=a[e].trim();if(''!==t)if(/^\d+\.\s/.test(t))s||n?n&&(i.push('</ul>'),i.push('<ol>'),n=!1,s=!0):(i.push('<ol>'),s=!0),t=t.replace(/^\d+\.\s/,''),i.push(`<li>${t}</li>`);else if(/^-\s/.test(t))n||s?s&&(i.push('</ol>'),i.push('<ul>'),s=!1,n=!0):(i.push('<ul>'),n=!0),t=t.replace(/^-\s/,''),i.push(`<li>${t}</li>`);else if(/^(\s{4,})-\s/.test(t)||/^(\s{4,})\d+\.\s/.test(t)){const e=t.match(/^(\s{4,})/),a=Math.floor(e[1].length/4),s=t.trim();if(/^-\s/.test(s)){const e=s.replace(/^-\s/,'');i.push(`<ul class="nested-list nested-level-${a}"><li>${e}</li></ul>`)}else if(/^\d+\.\s/.test(s)){const e=s.replace(/^\d+\.\s/,'');i.push(`<ol class="nested-list nested-level-${a}"><li>${e}</li></ol>`)}}else(s||n)&&(i.push(s?'</ol>':'</ul>'),s=!1,n=!1),i.push(t);else(s||n)&&(i.push(s?'</ol>':'</ul>'),s=!1,n=!1),i.push('')}s?i.push('</ol>'):n&&i.push('</ul>'),t=i.join('\n');const r=t.split('\n\n');return t=r.map(e=>''===e.trim()||e.match(/^<(ul|ol|li|table|blockquote|pre)/i)?e:`<p>${e}</p>`).join('\n\n'),t=t.replace(/\n(?!<\/?[a-z])/g,'<br>'),t}highlightSearchTerm(e){if(!this.searchTerm)return e;const t=new RegExp(`(${this.escapeRegExp(this.searchTerm)})`,'gi');return e.replace(t,'<span class="highlight">$1</span>')}escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')}filterFAQs(){this.filteredData=this.faqData.filter(e=>{const t=!this.searchTerm||e.question.toLowerCase().includes(this.searchTerm.toLowerCase())||e.answer.toLowerCase().includes(this.searchTerm.toLowerCase()),a='all'===this.activeCategory||e.category===this.activeCategory||e.mainCategory===this.activeCategory;return t&&a}),this.renderFAQs()}setActiveCategory(e){this.activeCategory=e,this.filterFAQs();document.querySelectorAll('.category-link').forEach(t=>{t.dataset.category===e?t.classList.add('active'):t.classList.remove('active')})}bindEvents(){const e=document.getElementById('faqSearch');e.addEventListener('input',e=>{this.searchTerm=e.target.value.trim(),this.filterFAQs()}),document.getElementById('faqList').addEventListener('click',e=>{const t=e.target.closest('.faq-question');if(t){const e=t.closest('.faq-item').querySelector('.faq-answer');if(!e)return;t.classList.toggle('active'),e.classList.toggle('active'),t.classList.contains('active')&&setTimeout(()=>{t.scrollIntoView({behavior:'smooth',block:'start',inline:'nearest'})},100)}}),document.querySelector('.faq-sidebar').addEventListener('click',e=>{const t=e.target.closest('.category-link');if(t){e.preventDefault();const a=t.dataset.category;this.setActiveCategory(a),window.scrollTo({top:0,behavior:'smooth'})}}),document.addEventListener('keydown',t=>{(t.ctrlKey||t.metaKey)&&'f'===t.key&&(t.preventDefault(),e.focus()),'Escape'===t.key&&document.activeElement===e&&(e.value='',this.searchTerm='',this.filterFAQs())})}hideLoading(){const e=document.getElementById('loadingSpinner'),t=document.getElementById('faqList');e.style.display='none',t.style.display='block',this.renderCategories()}showError(){const e=document.getElementById('loadingSpinner'),t=document.getElementById('errorMessage');e.style.display='none',t.style.display='block'}}document.addEventListener('DOMContentLoaded',()=>{new r}),window.FAQManager=r;