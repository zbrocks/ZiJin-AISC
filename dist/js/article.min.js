function n(){const n=document.querySelectorAll('.breadcrumb, .article-content, .content-section, .principle-card, .moment-card, .plan-item'),e=new IntersectionObserver(n=>{n.forEach((n,t)=>{n.isIntersecting&&(setTimeout(()=>{n.target.style.opacity='1',n.target.style.transform='translateY(0)'},50*t),e.unobserve(n.target))})},{threshold:.1,rootMargin:'0px 0px -50px 0px'});n.forEach(n=>{n.style.opacity='0',n.style.transform='translateY(20px)',n.style.transition='all 0.6s ease',e.observe(n)})}function e(){const n=document.createElement('div');n.className='reading-progress',n.innerHTML='<div class="progress-fill"></div>',document.body.appendChild(n);const e=n.querySelector('.progress-fill'),t=document.querySelector('.article-body');t&&window.addEventListener('scroll',()=>{const n=t.offsetTop,o=t.offsetHeight,r=window.innerHeight,a=window.pageYOffset,i=n-r/2,s=n+o-r/2;if(a>=i&&a<=s){const n=(a-i)/(s-i);e.style.width=Math.min(100*n,100)+'%'}else e.style.width=a<i?'0%':'100%'})}function t(){document.querySelectorAll('.timeline-event').forEach(n=>{n.addEventListener('click',function(){this.classList.toggle('expanded');const n=this.querySelector('.event-content');this.classList.contains('expanded')?n.style.maxHeight=n.scrollHeight+'px':n.style.maxHeight=''})});document.querySelectorAll('.principle-card').forEach(n=>{n.addEventListener('mouseenter',function(){this.style.transform='translateY(-5px) rotateY(5deg)'}),n.addEventListener('mouseleave',function(){this.style.transform='translateY(0) rotateY(0)'})});document.querySelectorAll('.moment-card').forEach(n=>{n.addEventListener('mouseenter',function(){this.style.background='linear-gradient(135deg, rgba(134, 93, 187, 0.1), rgba(134, 93, 187, 0.05))'}),n.addEventListener('mouseleave',function(){this.style.background=''})})}function o(){window.shareArticle=function(n){const e=window.location.href,t=`推荐阅读:${n}`;navigator.share?navigator.share({title:n,text:t,url:e}).then(()=>{showNotification('分享成功！','success')}).catch(t=>{r(n,e)}):r(n,e)}}function r(n,e){a([{name:'复制链接',icon:'fas fa-link',action:()=>{navigator.clipboard.writeText(e).then(()=>{showNotification('链接已复制到剪贴板','success')}).catch(()=>{const n=document.createElement('textarea');n.value=e,document.body.appendChild(n),n.select(),document.execCommand('copy'),document.body.removeChild(n),showNotification('链接已复制到剪贴板','success')})}},{name:'微信分享',icon:'fab fa-weixin',action:()=>{showNotification('请复制链接后在微信中分享','info'),navigator.clipboard.writeText(e)}},{name:'QQ分享',icon:'fab fa-qq',action:()=>{const t=`https://connect.qq.com/widget/shareqq/index.html?url=${encodeURIComponent(e)}&title=${encodeURIComponent(n)}`;window.open(t,'_blank')}},{name:'微博分享',icon:'fab fa-weibo',action:()=>{const t=`https://service.weibo.com/share/share.php?url=${encodeURIComponent(e)}&title=${encodeURIComponent(n)}`;window.open(t,'_blank')}}])}function a(n){const e=document.createElement('div');e.className='share-modal',e.innerHTML=`\n        <div class="share-modal-content">\n            <div class="share-modal-header">\n                <h3><i class="fas fa-share-alt"></i> 分享文章</h3>\n                <button class="close-btn">&times;</button>\n            </div>\n            <div class="share-options">\n                ${n.map(n=>`\n                    <button class="share-option" data-action="${n.name}">\n                        <i class="${n.icon}"></i>\n                        <span>${n.name}</span>\n                    </button>\n                `).join('')}\n            </div>\n        </div>\n    `,document.body.appendChild(e),setTimeout(()=>{e.classList.add('show')},10),e.querySelector('.close-btn').addEventListener('click',()=>{i(e)}),e.addEventListener('click',n=>{n.target===e&&i(e)}),n.forEach((n,t)=>{e.querySelector(`[data-action="${n.name}"]`).addEventListener('click',()=>{n.action(),i(e)})})}function i(n){n.classList.remove('show'),setTimeout(()=>{document.body.contains(n)&&document.body.removeChild(n)},300)}function s(){const n=document.querySelectorAll('.content-section h2');if(n.length>3){const e=document.createElement('div');e.className='table-of-contents',e.innerHTML=`\n            <h4><i class="fas fa-list"></i> 文章目录</h4>\n            <ul>\n                ${Array.from(n).map((n,e)=>{const t=`section-${e}`;return n.id=t,`<li><a href="#${t}">${n.textContent}</a></li>`}).join('')}\n            </ul>\n        `;const t=document.querySelector('.article-intro');t&&t.parentNode.insertBefore(e,t.nextSibling),e.querySelectorAll('a').forEach(n=>{n.addEventListener('click',e=>{e.preventDefault();const t=document.querySelector(n.getAttribute('href'));t&&t.scrollIntoView({behavior:'smooth',block:'start'})})})}}document.addEventListener('DOMContentLoaded',function(){n(),e(),t(),o(),initBookmarkFeature(),initScrollEffects()}),window.addEventListener('load',()=>{document.body.style.opacity='1',s()}),document.body.style.opacity='0',document.body.style.transition='opacity 0.5s ease';const c=document.createElement('style');c.textContent='\n    .reading-progress {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 4px;\n        background: rgba(134, 93, 187, 0.1);\n        z-index: 1000;\n    }\n    \n    .progress-fill {\n        height: 100%;\n        background: linear-gradient(90deg, var(--current-primary), var(--accent));\n        width: 0%;\n        transition: width 0.3s ease;\n    }\n    \n    .share-modal {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.5);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 1000;\n        opacity: 0;\n        transition: opacity 0.3s ease;\n    }\n    \n    .share-modal.show {\n        opacity: 1;\n    }\n    \n    .share-modal-content {\n        background: var(--current-card-bg);\n        border-radius: 15px;\n        padding: 30px;\n        max-width: 400px;\n        width: 90%;\n        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n        transform: translateY(20px);\n        transition: transform 0.3s ease;\n    }\n    \n    .share-modal.show .share-modal-content {\n        transform: translateY(0);\n    }\n    \n    .share-modal-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 20px;\n    }\n    \n    .share-modal-header h3 {\n        margin: 0;\n        color: var(--current-primary);\n        display: flex;\n        align-items: center;\n        gap: 10px;\n    }\n    \n    .close-btn {\n        background: none;\n        border: none;\n        font-size: 1.5em;\n        cursor: pointer;\n        color: var(--current-text-secondary);\n        transition: color 0.3s ease;\n    }\n    \n    .close-btn:hover {\n        color: var(--current-primary);\n    }\n    \n    .share-options {\n        display: grid;\n        grid-template-columns: repeat(2, 1fr);\n        gap: 10px;\n    }\n    \n    .share-option {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        padding: 15px;\n        background: rgba(134, 93, 187, 0.1);\n        border: none;\n        border-radius: 10px;\n        cursor: pointer;\n        color: var(--current-text);\n        transition: all 0.3s ease;\n        text-align: left;\n    }\n    \n    .share-option:hover {\n        background: rgba(134, 93, 187, 0.2);\n        transform: translateY(-2px);\n    }\n    \n    .share-option i {\n        color: var(--current-primary);\n        width: 20px;\n        text-align: center;\n    }\n    \n    .notification {\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        background: var(--current-card-bg);\n        border-radius: 10px;\n        padding: 15px 20px;\n        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n        transform: translateX(400px);\n        transition: all 0.3s ease;\n        z-index: 1001;\n        border-left: 4px solid;\n        max-width: 300px;\n    }\n    \n    .notification.show {\n        transform: translateX(0);\n    }\n    \n    .notification-success {\n        border-left-color: #4CAF50;\n    }\n    \n    .notification-error {\n        border-left-color: #f44336;\n    }\n    \n    .notification-warning {\n        border-left-color: #FFC107;\n    }\n    \n    .notification-info {\n        border-left-color: var(--current-primary);\n    }\n    \n    .notification-content {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        color: var(--current-text);\n    }\n    \n    .notification-close {\n        background: none;\n        border: none;\n        color: var(--current-text-secondary);\n        cursor: pointer;\n        font-size: 1.2em;\n        margin-left: auto;\n    }\n    \n    .btn-secondary.bookmarked {\n        background: var(--current-primary);\n        color: white;\n    }\n    \n    .table-of-contents {\n        background: rgba(134, 93, 187, 0.05);\n        border-radius: 12px;\n        padding: 20px;\n        margin: 30px 0;\n        border-left: 4px solid var(--current-primary);\n    }\n    \n    .table-of-contents h4 {\n        color: var(--current-primary);\n        margin: 0 0 15px 0;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n    }\n    \n    .table-of-contents ul {\n        list-style: none;\n        padding: 0;\n        margin: 0;\n    }\n    \n    .table-of-contents li {\n        margin-bottom: 8px;\n    }\n    \n    .table-of-contents a {\n        color: var(--current-text-secondary);\n        text-decoration: none;\n        transition: color 0.3s ease;\n        display: block;\n        padding: 5px 0;\n    }\n    \n    .table-of-contents a:hover {\n        color: var(--current-primary);\n    }\n    \n    .timeline-event.expanded .event-content {\n        background: rgba(134, 93, 187, 0.1);\n    }\n    \n    header {\n        transition: transform 0.3s ease;\n    }\n    \n    @media (max-width: 768px) {\n        .share-options {\n            grid-template-columns: 1fr;\n        }\n        \n        .notification {\n            right: 10px;\n            left: 10px;\n            transform: translateY(-100px);\n            max-width: none;\n        }\n        \n        .notification.show {\n            transform: translateY(0);\n        }\n    }\n',document.head.appendChild(c),'ontouchstart'in window&&document.addEventListener('touchstart',()=>{document.querySelectorAll('.principle-card, .moment-card, .plan-item').forEach(n=>{n.style.cursor='pointer'})});