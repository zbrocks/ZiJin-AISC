class e{constructor(){this.faqData=[],this.filteredData=[],this.searchTerm='',this.activeCategory='all',this.categories={},this.init()}async init(){try{await this.loadFAQData(),this.renderFAQs(),this.bindEvents(),this.hideLoading()}catch(e){this.showError()}}async loadFAQData(){try{const e=await fetch('/assets/FAQs.md');if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.text();this.parseFAQMarkdown(t)}catch(e){throw e}}parseFAQMarkdown(e){const t=e.split('\n');let a=null,s=[],i='',r='',n='';for(let e=0;e<t.length;e++){const o=t[e].trim();o.startsWith('# ')||(o.startsWith('## ')?(a&&this.faqData.push({question:a,answer:s.join('\n').trim(),category:n,mainCategory:i,subCategory:r,id:this.generateId(a)}),i=o.substring(3).trim(),n=i,a=null,s=[]):o.startsWith('### ')?(a&&this.faqData.push({question:a,answer:s.join('\n').trim(),category:n,mainCategory:i,subCategory:r,id:this.generateId(a)}),a=o.substring(4).trim(),r=a,n=`${i}-${r}`,s=[]):a&&o&&s.push(o))}a&&this.faqData.push({question:a,answer:s.join('\n').trim(),category:n,mainCategory:i,subCategory:r,id:this.generateId(a)}),this.organizeCategories(),this.filteredData=[...this.faqData]}organizeCategories(){this.categories={},this.faqData.forEach(e=>{this.categories[e.mainCategory]||(this.categories[e.mainCategory]={name:e.mainCategory,count:0,subCategories:{}}),this.categories[e.mainCategory].count++,this.categories[e.mainCategory].subCategories[e.subCategory]||(this.categories[e.mainCategory].subCategories[e.subCategory]={name:e.subCategory,count:0,fullCategory:e.category}),this.categories[e.mainCategory].subCategories[e.subCategory].count++})}renderCategories(){const e=document.querySelector('.faq-sidebar');if(!e)return;let t=e.querySelector('.faq-categories');t||(t=document.createElement('div'),t.className='faq-categories',e.appendChild(t)),t.innerHTML=`\n            <h3><i class="fas fa-tags"></i> 问题分类</h3>\n            <ul class="main-categories">\n                <li>\n                    <a href="#" data-category="all" class="category-link ${'all'===this.activeCategory?'active':''}">\n                        <i class="fas fa-layer-group"></i> 全部问题\n                    </a>\n                </li>\n            </ul>\n        `;const a=t.querySelector('.main-categories');Object.keys(this.categories).forEach(e=>{this.categories[e];const t=document.createElement('li');t.className='main-category-item',t.innerHTML=`\n                <a href="#" data-category="${e}" class="category-link main-category-link ${this.activeCategory===e?'active':''}">\n                    ${e}\n                </a>\n            `,a.appendChild(t)})}generateId(e){const t=Date.now(),a=Math.floor(1e3*Math.random());return`${e.toLowerCase().replace(/[^\w\s-]/g,'').replace(/\s+/g,'-').substring(0,30)}-${t}-${a}`}handleLazyImages(){const e=document.querySelectorAll('.lazy-image');if('IntersectionObserver'in window){const t=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const a=e.target;a.onload=()=>{a.classList.add('loaded')},a.complete&&a.classList.add('loaded'),t.unobserve(a)}})},{rootMargin:'0px 0px 200px 0px'});e.forEach(e=>{t.observe(e)})}else e.forEach(e=>{e.classList.add('loaded')})}renderFAQs(){const e=document.getElementById('faqList');0!==this.filteredData.length?(e.innerHTML=this.filteredData.map(e=>`\n            <div class="faq-item" data-category="${e.category}" data-main-category="${e.mainCategory}">\n                <button class="faq-question" data-id="${e.id}">\n                    <span class="tag">${e.mainCategory}</span>\n                    <span class="faq-question-text">${this.highlightSearchTerm(e.question)}</span>\n                    <i class="fas fa-chevron-down faq-toggle"></i>\n                </button>\n                <div class="faq-answer" id="answer-${e.id}">\n                    <div class="faq-answer-content">\n                        ${this.formatAnswer(e.answer)}\n                    </div>\n                </div>\n            </div>\n        `).join(''),this.handleLazyImages()):e.innerHTML='\n                <div class="no-results">\n                    <i class="fas fa-search"></i>\n                    <p>没有找到匹配的问题,请尝试其他关键词.</p>\n                </div>\n            '}formatAnswer(e){let t=e;t=t.replace(/\*\*([^\*]+)\*\*/g,'<strong>$1</strong>'),t=t.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank">$1</a>'),t=t.replace(/!\[([^\]]+)\]\(([^)]+)\)/g,'<img src="$2" alt="$1" loading="lazy" class="lazy-image" />'),t=t.replace(/`([^`]+)`/g,'<code>$1</code>');const a=t.split('\n');let s=!1,i=!1,r=[];for(let e=0;e<a.length;e++){let t=a[e].trim();if(''!==t)if(/^\d+\.\s/.test(t))s||i?i&&(r.push('</ul>'),r.push('<ol>'),i=!1,s=!0):(r.push('<ol>'),s=!0),t=t.replace(/^\d+\.\s/,''),r.push(`<li>${t}</li>`);else if(/^-\s/.test(t))i||s?s&&(r.push('</ol>'),r.push('<ul>'),s=!1,i=!0):(r.push('<ul>'),i=!0),t=t.replace(/^-\s/,''),r.push(`<li>${t}</li>`);else if(/^(\s{4,})-\s/.test(t)||/^(\s{4,})\d+\.\s/.test(t)){const e=t.match(/^(\s{4,})/),a=Math.floor(e[1].length/4),s=t.trim();if(/^-\s/.test(s)){const e=s.replace(/^-\s/,'');r.push(`<ul class="nested-list nested-level-${a}"><li>${e}</li></ul>`)}else if(/^\d+\.\s/.test(s)){const e=s.replace(/^\d+\.\s/,'');r.push(`<ol class="nested-list nested-level-${a}"><li>${e}</li></ol>`)}}else(s||i)&&(r.push(s?'</ol>':'</ul>'),s=!1,i=!1),r.push(t);else(s||i)&&(r.push(s?'</ol>':'</ul>'),s=!1,i=!1),r.push('')}s?r.push('</ol>'):i&&r.push('</ul>'),t=r.join('\n');const n=t.split('\n\n');return t=n.map(e=>''===e.trim()||e.match(/^<(ul|ol|li|table|blockquote|pre)/i)?e:`<p>${e}</p>`).join('\n\n'),t=t.replace(/\n(?!<\/?[a-z])/g,'<br>'),t}highlightSearchTerm(e){if(!this.searchTerm)return e;const t=new RegExp(`(${this.escapeRegExp(this.searchTerm)})`,'gi');return e.replace(t,'<span class="highlight">$1</span>')}escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')}filterFAQs(){this.filteredData=this.faqData.filter(e=>{const t=!this.searchTerm||e.question.toLowerCase().includes(this.searchTerm.toLowerCase())||e.answer.toLowerCase().includes(this.searchTerm.toLowerCase()),a='all'===this.activeCategory||e.category===this.activeCategory||e.mainCategory===this.activeCategory;return t&&a}),this.renderFAQs()}setActiveCategory(e){this.activeCategory=e,this.filterFAQs();document.querySelectorAll('.category-link').forEach(t=>{t.dataset.category===e?t.classList.add('active'):t.classList.remove('active')})}bindEvents(){const e=document.getElementById('faqSearch');e.addEventListener('input',e=>{this.searchTerm=e.target.value.trim(),this.filterFAQs()}),document.getElementById('faqList').addEventListener('click',e=>{const t=e.target.closest('.faq-question');if(t){const e=t.closest('.faq-item').querySelector('.faq-answer');if(!e)return;t.classList.toggle('active'),e.classList.toggle('active'),t.classList.contains('active')&&setTimeout(()=>{t.scrollIntoView({behavior:'smooth',block:'start',inline:'nearest'})},100)}}),document.querySelector('.faq-sidebar').addEventListener('click',e=>{const t=e.target.closest('.category-link');if(t){e.preventDefault();const a=t.dataset.category;this.setActiveCategory(a),window.scrollTo({top:0,behavior:'smooth'})}}),document.addEventListener('keydown',t=>{(t.ctrlKey||t.metaKey)&&'f'===t.key&&(t.preventDefault(),e.focus()),'Escape'===t.key&&document.activeElement===e&&(e.value='',this.searchTerm='',this.filterFAQs())})}hideLoading(){const e=document.getElementById('loadingSpinner'),t=document.getElementById('faqList');e.style.display='none',t.style.display='block',this.renderCategories()}showError(){const e=document.getElementById('loadingSpinner'),t=document.getElementById('errorMessage');e.style.display='none',t.style.display='block'}}document.addEventListener('DOMContentLoaded',()=>{new e}),window.FAQManager=e;